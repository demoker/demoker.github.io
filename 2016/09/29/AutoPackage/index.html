<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 自动打包，上传服务器 · demoker</title><meta name="description" content="自动打包，上传服务器 - demoker－小马哥"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://demoker.co/atom.xml" title="demoker"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="http://weibo.com/u/1974955620?is_all=1" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="https://github.com/demoker" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/404/index.md" target="_self" class="nav-list-link">好友BLOG</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">自动打包，上传服务器</h1><div class="post-info">Sep 29, 2016</div><div class="post-content"><script src="/assets/js/DPlayer.min.js"> </script><p>1.配置：在工程所在目录下PackageShell文件夹，其中包括一个package文件夹（存放打包后的相关文件）、PackageConfig文件夹（其中存放app的相关配置.plist）</p>
<p>2.运行.sh脚本：进入到所在文件夹下，然后./name.sh 敲回车，这样就运行了</p>
<p>3.脚本content：<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line">profile_Name=`/usr/libexec/PlistBuddy -c &quot;print profile_Name&quot; ./PackageConfig/xx.plist`</div><div class="line">ipa_Name=`/usr/libexec/PlistBuddy -c &quot;print app_Name&quot; ./PackageConfig/xx.plist`</div><div class="line">cd ../xxprojectName</div><div class="line">echo &quot;go to xxprojectName workspace path&quot;</div><div class="line">#</div><div class="line">#buildDay=$(date +%Y%m%d)</div><div class="line">buildTime=$(date +%Y%m%d%H%M)</div><div class="line">profile=&quot;$&#123;profile_Name&#125;&quot;</div><div class="line">echo $profile $ipa_Name</div><div class="line">if [ ! -d &quot;../PackageShell/Package&quot; ]; then</div><div class="line">mkdir ../PackageShell/Package</div><div class="line">fi</div><div class="line">if [ ! -d &quot;../PackageShell/Package/ArchiveProduction&quot; ]; then</div><div class="line">mkdir ../PackageShell/Package/ArchiveProduction</div><div class="line">fi</div><div class="line">if [ ! -d &quot;../PackageShell/Package/ArchiveProduction/QA&quot; ]; then</div><div class="line">mkdir ../PackageShell/Package/ArchiveProduction/QA</div><div class="line">echo &quot;Create ArchiveProduction path&quot;</div><div class="line">fi</div><div class="line">if [ ! -d &quot;../PackageShell/Package/ipa&quot; ]; then</div><div class="line">mkdir ../PackageShell/Package/ipa</div><div class="line">fi</div><div class="line">if [ ! -d &quot;../PackageShell/Package/ipa/QA&quot; ]; then</div><div class="line">mkdir ../PackageShell/Package/ipa/QA</div><div class="line">echo &quot;Create ipa path&quot;</div><div class="line">fi</div><div class="line">#</div><div class="line">buildConfiguration=&quot;QA&quot;</div><div class="line">buildPath=&quot;../PackageShell/Package/ArchiveProduction/QA/$&#123;ipa_Name&#125;_$&#123;buildTime&#125;.xcarchive&quot;</div><div class="line">#ipaName=&quot;../PackageShell/Package/ipa/QA/$&#123;ipa_Name&#125;_$&#123;buildTime&#125;.ipa&quot;</div><div class="line">ipaName=&quot;../PackageShell/Package/ipa/QA/$&#123;ipa_Name&#125;.ipa&quot;</div><div class="line">xctool -workspace xxprojectName.xcworkspace -scheme xxprojectName -configuration $&#123;buildConfiguration&#125; clean</div><div class="line">xctool -workspace xxprojectName.xcworkspace -scheme xxprojectName -configuration $&#123;buildConfiguration&#125; archive -archivePath $&#123;buildPath&#125;</div><div class="line">xcodebuild -exportArchive -exportFormat IPA -archivePath $&#123;buildPath&#125; -exportPath $&#123;ipaName&#125; -exportProvisioningProfile &quot;$profile&quot;</div></pre></td></tr></table></figure></p>
<p>4.针对部署下面进行研究：</p>
<p>方式一：</p>
<p>使用curl 上传文件，示例代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#上传到蒲公英</div><div class="line">curl -F &quot;file=@&quot;$&#123;ipaName&#125; \</div><div class="line">-F &quot;uKey=7a293adb2ae692594483b846bfc4ddc8&quot; \</div><div class="line">-F &quot;_api_key=9440f27246757ebc2b92286186b4690b&quot; \</div><div class="line">https://www.pgyer.com/apiv1/app/upload</div></pre></td></tr></table></figure></p>
<p>方式二：</p>
<p>mattt大神的－－SHENZHEN</p>
<p>安装：<br><figure class="highlight plain"><figcaption><span>gem install shenzhen ```</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">具体使用方法详见[git](https://github.com/nomad/shenzhen)</div><div class="line"></div><div class="line">下面针对FIR、蒲公英和FTP给予使用说明：</div><div class="line"></div><div class="line">FTP Distribution</div><div class="line"></div><div class="line">``` $ ipa distribute:ftp --host HOST -u USER -p PASSWORD -P FTP_PATH</div></pre></td></tr></table></figure></p>
<p>蒲公英 (PGYER)</p>
<p><code>$ ipa distribute:pgyer -u USER_KEY -a APP_KEY</code></p>
<p>FIR</p>
<p><code>$ ipa distribute:fir -u USER_TOKEN -a APP_ID</code> </p>
<p>以上脚本中使用到xctool，xctool是facebook对xcodebuild的封装.</p>
<p>参考blog：</p>
<p><a href="http://liumh.com/2015/11/25/ios-auto-archive-ipa/" target="_blank" rel="external">iOS自动打包并发布脚本</a></p>
<p><a href="http://www.anselz.com/2014/10/30/ios-开发自动打包/" target="_blank" rel="external">iOS开发自动打包</a></p>
<p><a href="http://www.vienta.me/2016/02/24/iOS批量自动打包和部署-Ⅱ-自动打包/" target="_blank" rel="external">iOS批量自动打包和部署(Ⅱ):自动打包</a></p>
<p><a href="https://github.com/nomad/shenzhen" target="_blank" rel="external">shenzhen</a></p>
<p><a href="http://blog.csdn.net/u010124617/article/details/46547523" target="_blank" rel="external">多渠道批量打包</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/09/29/MicrometerLevelFormat/" class="next">NEXT</a></div><div data-thread-key="2016/09/29/AutoPackage/" data-title="自动打包，上传服务器" data-url="http://demoker.co/2016/09/29/AutoPackage/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"demoker"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2016 <a href="http://demoker.co">demoker－小马哥</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>